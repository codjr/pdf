<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF - Marinha</title>
<link rel="icon" type="image/svg+xml" href="https://upload.wikimedia.org/wikipedia/commons/8/87/PDF_file_icon.svg">
<style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Arial, sans-serif; }
    body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: radial-gradient(circle at top, #003366, #001a33);
        color: #fff;
    }
    .container {
        background: rgba(0, 33, 71, 0.9);
        padding: 40px 35px;
        border-radius: 14px;
        text-align: center;
        width: 90%;
        max-width: 460px;
        border: 2px solid #cce6ff;
        box-shadow: 0 0 25px rgba(0,0,0,0.5);
    }
    .logo {
        width: 70px;
        height: 70px;
        margin-bottom: 15px;
        filter: drop-shadow(0 0 3px #cce6ff);
    }
    h2 {
        margin-bottom: 8px;
        font-size: 1.6em;
        color: #ffffff;
        text-shadow: 1px 1px 3px #000;
    }
    .author {
        font-size: 0.9em;
        margin-bottom: 25px;
        color: #b3d9ff;
    }
    input[type="file"] { display: none; }
    .custom-file-upload {
        display: inline-block;
        padding: 14px 35px;
        cursor: pointer;
        background-color: #ffffff;
        color: #002147;
        font-weight: bold;
        border-radius: 8px;
        border: 2px solid #ffffff;
        transition: 0.3s ease;
        box-shadow: 0 3px 6px rgba(0,0,0,0.4);
        margin-bottom: 18px;
    }
    .custom-file-upload:hover {
        background-color: #cce6ff;
        color: #001a33;
        transform: scale(1.05);
    }
    .drop-zone {
        border: 2px dashed #b3d9ff;
        border-radius: 10px;
        padding: 30px;
        color: #cce6ff;
        cursor: pointer;
        margin-bottom: 18px;
        transition: 0.3s ease;
    }
    .drop-zone.dragover {
        background-color: rgba(255,255,255,0.1);
        border-color: #ffffff;
        color: #ffffff;
    }
    .info {
        margin-top: 16px;
        font-size: 0.9em;
        color: #cce6ff;
        line-height: 1.4;
    }
    #fileList {
        margin-top: 18px;
        text-align: left;
        font-size: 0.9em;
        color: #e0e0e0;
        max-height: 150px;
        overflow-y: auto;
        border-top: 1px solid rgba(255,255,255,0.2);
        padding-top: 10px;
    }
    #fileList li {
        margin-bottom: 6px;
        list-style-type: "ðŸ“„ ";
    }
    @media (max-width: 600px) {
        .container { padding: 30px 20px; }
        .custom-file-upload { padding: 12px 25px; }
    }
</style>
</head>
<body>
    <div class="container">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/87/PDF_file_icon.svg" class="logo" alt="PDF logo">
        <h2>Processador de PDFs</h2>
        <div class="author">Â© Nelson Ferreira - 25061321 - 2025</div>

        <label class="custom-file-upload">
            Selecionar PDFs
            <input type="file" id="fileInput" multiple accept="application/pdf">
        </label>

        <div class="drop-zone" id="dropZone">Arraste e solte os PDFs aqui</div>

        <div class="info">
            Selecione ou arraste arquivos PDF.<br>
            SerÃ¡ gerado um arquivo ZIP com os resultados.
        </div>

        <ul id="fileList"></ul>
    </div>

<script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
const { PDFDocument, rgb, StandardFonts } = PDFLib;
const fileList = document.getElementById("fileList");
const dropZone = document.getElementById("dropZone");
const fileInput = document.getElementById("fileInput");

async function processFiles(files) {
    fileList.innerHTML = "";
    const zip = new JSZip();

    for (const file of files) {
        if (file.type !== "application/pdf") continue;

        const li = document.createElement("li");
        li.textContent = `Processando: ${file.name}...`;
        fileList.appendChild(li);

        const arrayBuffer = await file.arrayBuffer();
        const originalPdf = await PDFDocument.load(arrayBuffer);
        const totalPages = originalPdf.getPageCount();

        if (totalPages <= 1) {
            li.textContent = `Erro: ${file.name} tem apenas 1 pÃ¡gina`;
            continue;
        }

        const newPdf = await PDFDocument.create();
        const pagesToCopy = await newPdf.copyPages(originalPdf, Array.from({ length: totalPages - 1 }, (_, i) => i + 1));
        pagesToCopy.forEach((p) => newPdf.addPage(p));

        const font = await newPdf.embedFont(StandardFonts.Helvetica);
        const footerText = "Â© Nelson Ferreira - 25061321 - 2025";
        newPdf.getPages().forEach((page) => {
            const { width } = page.getSize();
            page.drawText(footerText, { x: 20, y: 15, size: 9, font, color: rgb(0.7,0.7,0.7) });
        });

        const pdfBytes = await newPdf.save();

        let baseName = file.name.replace(".pdf", "");
        let match = baseName.match(/^bp(\d+)-(\d{6})$/i);
        let newName = "BP Arquivo.pdf";

        if (match) {
            let nip = match[1];
            let mesAno = match[2];
            let mes = mesAno.slice(0, 2);
            let ano = mesAno.slice(2);
            newName = `BP ${nip} - ${mes}_${ano}.pdf`;
        }

        zip.file(newName, pdfBytes);
        li.textContent = `ConcluÃ­do: ${newName}`;
    }

    zip.generateAsync({ type: "blob" }).then((content) => {
        saveAs(content, "BP PROCESSADOS - Nelson Ferreira.zip");
    });
}

fileInput.addEventListener("change", (event) => processFiles(event.target.files));

dropZone.addEventListener("dragover", (event) => {
    event.preventDefault();
    dropZone.classList.add("dragover");
});

dropZone.addEventListener("dragleave", () => dropZone.classList.remove("dragover"));

dropZone.addEventListener("drop", (event) => {
    event.preventDefault();
    dropZone.classList.remove("dragover");
    processFiles(event.dataTransfer.files);
});
</script>
</body>
</html>
