<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>PDF - Marinha</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Arial', sans-serif; }
    body {
      display: flex; justify-content: center; align-items: center; min-height: 100vh;
      background-color: #002147; color: #fff;
    }
    .container {
      background-color: #003366; padding: 40px; border-radius: 12px; text-align: center;
      box-shadow: 0 6px 15px rgba(0,0,0,0.4); width: 450px; border: 2px solid #fff;
    }
    h2 { margin-bottom: 15px; font-size: 1.5em; color: #ffffff; text-shadow: 1px 1px 2px #000; }
    .author { margin-bottom: 25px; font-size: 0.9em; color: #cce6ff; }

    input[type="file"] { display: none; }
    .custom-file-upload {
      display: inline-block; padding: 14px 30px; cursor: pointer; background-color: #ffffff;
      color: #002147; font-weight: bold; border-radius: 6px; border: 2px solid #ffffff;
      transition: all 0.3s ease; box-shadow: 0 3px 6px rgba(0,0,0,0.3);
      margin-bottom: 15px;
    }
    .custom-file-upload:hover { background-color: #cce6ff; color: #002147; }

    .drop-zone {
      border: 2px dashed #cce6ff;
      border-radius: 8px;
      padding: 30px;
      color: #cce6ff;
      cursor: pointer;
      margin-bottom: 15px;
      transition: background 0.3s ease;
    }
    .drop-zone.dragover {
      background-color: rgba(255,255,255,0.1);
      border-color: #fff;
      color: #fff;
    }

    .info { margin-top: 18px; font-size: 0.9em; color: #cce6ff; }
    #fileList { margin-top: 15px; text-align: left; font-size: 0.9em; color: #e0e0e0; }
    #fileList li { margin-bottom: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>PDF</h2>
    <div class="author">Criado por: © Nelson Ferreira - 25061321 - 2025</div>

    <label class="custom-file-upload">
      Selecionar PDFs
      <input type="file" id="fileInput" multiple accept="application/pdf" />
    </label>

    <div class="drop-zone" id="dropZone">
      Arraste e solte os PDFs aqui
    </div>

    <div class="info">
      Selecione ou arraste arquivos PDF.<br>
      Será gerado um arquivo ZIP para download.
    </div>

    <ul id="fileList"></ul>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <script>
    const { PDFDocument, rgb, StandardFonts } = PDFLib;
    const fileList = document.getElementById("fileList");
    const dropZone = document.getElementById("dropZone");
    const fileInput = document.getElementById("fileInput");

    // Função principal de processamento
    async function processFiles(files) {
      fileList.innerHTML = "";
      const zip = new JSZip();

      for (const file of files) {
        if (file.type !== "application/pdf") continue;

        const li = document.createElement("li");
        li.textContent = `Processando: ${file.name}...`;
        fileList.appendChild(li);

        const arrayBuffer = await file.arrayBuffer();
        const originalPdf = await PDFDocument.load(arrayBuffer);
        const totalPages = originalPdf.getPageCount();

        if (totalPages <= 1) {
          li.textContent = `Erro: ${file.name} só tem 1 página`;
          continue;
        }

        const newPdf = await PDFDocument.create();
        const pagesToCopy = await newPdf.copyPages(originalPdf, Array.from({ length: totalPages - 1 }, (_, i) => i + 1));
        pagesToCopy.forEach((p) => newPdf.addPage(p));

        // Adiciona rodapé
        const font = await newPdf.embedFont(StandardFonts.Helvetica);
        const footerText = "© Nelson Ferreira - 25061321 - 2025";
        newPdf.getPages().forEach((page) => {
          const { width, height } = page.getSize();
          page.drawText(footerText, {
            x: 20,
            y: 15,
            size: 9,
            font: font,
            color: rgb(0.7,0.7,0.7),
          });
        });

        const pdfBytes = await newPdf.save();

        // Nome do arquivo
        let baseName = file.name.replace(".pdf", "");
        let match = baseName.match(/^bp(\d+)-(\d{6})$/i);
        let newName = "BP Arquivo.pdf";

        if (match) {
          let nip = match[1];      
          let mesAno = match[2];   
          let mes = mesAno.slice(0, 2);
          let ano = mesAno.slice(2);
          newName = `BP ${nip} - ${mes}_${ano}.pdf`;
        }

        zip.file(newName, pdfBytes);
        li.textContent = `Concluído: ${newName}`;
      }

      zip.generateAsync({ type: "blob" }).then(function(content) {
        saveAs(content, "BP PROCESSADOS © Nelson Ferreira - 25061321 - 2025.zip");
      });
    }

    // Input de arquivo normal
    fileInput.addEventListener("change", (event) => {
      processFiles(event.target.files);
    });

    // Drag & Drop
    dropZone.addEventListener("dragover", (event) => {
      event.preventDefault();
      dropZone.classList.add("dragover");
    });

    dropZone.addEventListener("dragleave", () => {
      dropZone.classList.remove("dragover");
    });

    dropZone.addEventListener("drop", (event) => {
      event.preventDefault();
      dropZone.classList.remove("dragover");
      processFiles(event.dataTransfer.files);
    });
  </script>
</body>
</html>

